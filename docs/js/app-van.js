(()=>{var B=Object,f,u=B.getPrototypeOf,K=document,A,S,y,Y={isConnected:1},De=1e3,I,Q={},we=u(Y),Z=u(u),j=(e,t,l,n)=>(e??(setTimeout(l,n),new Set)).add(t),ee=(e,t,l)=>{let n=S;S=t;try{return e(l)}catch(r){return console.error(r),l}finally{S=n}},x=e=>e.filter(t=>t._dom?.isConnected),te=e=>I=j(I,e,()=>{for(let t of I)t._bindings=x(t._bindings),t._listeners=x(t._listeners);I=f},De),_={get val(){return S?.add(this),this._val},get oldVal(){return S?.add(this),this._oldVal},set val(e){let t=this;if(e!==t._val){t._val=e;let l=[...t._listeners=x(t._listeners)];for(let n of l)L(n.f,n.s,n._dom),n._dom=f;t._bindings.length?A=j(A,t,Ae):t._oldVal=e}}},ne=e=>({__proto__:_,_val:e,_oldVal:e,_bindings:[],_listeners:[]}),le=e=>u(e??0)===_,ke=e=>le(e)?e.val:e,Ce=e=>le(e)?e.oldVal:e,T=(e,t)=>{let l=new Set,n={f:e},r=y;y=[];let o=ee(e,l,t);o=(o??K).nodeType?o:new Text(o);for(let a of l)te(a),a._bindings.push(n);for(let a of y)a._dom=o;return y=r,n._dom=o},L=(e,t=ne(),l)=>{let n=new Set,r={f:e,s:t};r._dom=l??y?.push(r)??Y,t.val=ee(e,n,t._val);for(let o of n)te(o),o._listeners.push(r);return t},re=(e,...t)=>{for(let l of t.flat(1/0)){let n=u(l??0),r=n===_?T(()=>l.val):n===Z?T(l):l;r!=f&&e.append(r)}return e},Ie=e=>(e._isBindingFunc=1,e),U=e=>new Proxy((t,...l)=>{let[n,...r]=u(l[0]??0)===we?l:[{},...l],o=e?K.createElementNS(e,t):K.createElement(t);for(let[a,i]of B.entries(n)){let d=h=>h?B.getOwnPropertyDescriptor(h,a)??d(u(h)):f,s=t+","+a,C=Q[s]??(Q[s]=d(u(o))?.set??0),z=a.startsWith("on")?(h,be)=>{let q=a.slice(2);o.removeEventListener(q,be),o.addEventListener(q,h)}:C?C.bind(o):o.setAttribute.bind(o,a),V=u(i??0);V===Z&&(!a.startsWith("on")||i._isBindingFunc)&&(i=L(i),V=_),V===_?T(()=>(z(i.val,i._oldVal),o)):z(i)}return re(o,...r)},{get:(t,l)=>t.bind(f,l)}),oe=(e,t)=>t?t!==e&&e.replaceWith(t):e.remove(),Ae=()=>{let e=[...A].filter(t=>t._val!==t._oldVal);A=f;for(let t of new Set(e.flatMap(l=>l._bindings=x(l._bindings))))oe(t._dom,T(t.f,t._dom)),t._dom=f;for(let t of e)t._oldVal=t._val},xe=(e,t)=>oe(e,T(t,e)),c={add:re,_:Ie,tags:U(),tagsNS:U,state:ne,val:ke,oldVal:Ce,derive:L,hydrate:xe};var{fromEntries:Ee,entries:se,keys:Me,getPrototypeOf:ue}=Object,{get:Pe,set:ae,deleteProperty:ie,ownKeys:Ne}=Reflect,p=Symbol,{state:F,derive:Oe,add:Ve,tags:lt}=c,Be=ue(F()),E,Ke=1e3,ce,m=p(),Le=p(),Fe=p(),M=p(),b=p(),G=p();var de=e=>e?.[Fe]?Oe(()=>D(e())):F(D(e)),D=e=>{if(!(e instanceof Object)||e[m])return e;let t=new Proxy((e[m]=Ee(se(e).map(([l,n])=>[l,de(n)])),e[Le]=e,e[M]=[],e[b]=F(1),e),{get:(l,n)=>ue(l[m][n]??0)===Be?l[m][n].val:(n==="length"&&l[b].val,Pe(l,n,t)),set(l,n,r){let o=l[m];if(n in o)return o[n].val=D(r),1;let a=n in l;if(ae(l,n,r))return a||ae(o,n,de(r))&&(++l[b].val,He(t,n,o[n])),1},deleteProperty:(l,n)=>(ie(l[m],n)&&Re(l,n),ie(l,n)&&++l[b].val),ownKeys:l=>(l[b].val,Ne(l))});return t};var H=e=>e[M]=e[M].filter(t=>t._containerDom.isConnected),Ge=(e,t,l,n)=>()=>{let r=n(l,()=>delete e[t],t);return r[G]=t,r},fe=(e,t,l,{_containerDom:n,f:r},o)=>{if(Ve(n,Ge(e,t,l,r)),!o&&Array.isArray(e)&&t!=e.length-1){let a={};for(let d of n.childNodes)a[d[G]]=d;let i=n.firstChild;for(let d of Me(e))i===a[d]?i=i.nextSibling:n.insertBefore(a[d],i)}},He=(e,t,l)=>H(e).forEach(fe.bind(ce,e,t,l)),Re=(e,t)=>{for(let l of H(e))[...l._containerDom.childNodes].find(n=>n[G]===t)?.remove()},We=e=>(E??(E=(setTimeout(()=>(E.forEach(H),E=ce),Ke),new Set))).add(e),me=(e,t,l)=>{let n={_containerDom:e(),f:l};t[M].push(n),We(t);for(let[r,o]of se(t[m]))fe(t,r,o,n,1);return n._containerDom};var{div:w,input:$e,button:v,span:P,br:N,label:ye,select:Se,option:X,dialog:Je,h2:ze,form:qe}=c.tags,pe="appState",O="random",$=[["random","Random"],["air-raid","Air Raid"],["bell","Bell"],["fire-truck","Fire Truck"],["kyrie","Kyrie eleison"],["song","Song"],["tibetan","Tibetan"],["warfare","Warfare"]];function Qe(){let e=JSON.parse(localStorage.getItem(pe)??'{"sound":"random","timers":[]}'),t=D({sound:e.sound||"random",timers:e.timers.filter(n=>n)});O=t.sound;let l=t.timers;return c.derive(()=>{let n=JSON.stringify({sound:t.sound,timers:l.filter(r=>r)});console.log("saving",n),localStorage.setItem(pe,n)}),[me(w,l,({val:n})=>{let{hours:r,minutes:o,seconds:a}=n,i=c.state(0),d=c.state("stopped");return w(R(r,"Hrs",s=>n.hours=+(s.target?.value||0)),":",R(o,"Min",s=>n.minutes=+(s.target?.value||0)),":",R(a,"Sec",s=>n.seconds=+(s.target?.value||0))," \u2014 ",Ue(n,i,d),v({class:()=>d.val==="stopped"?"":"hidden",onclick:()=>{d.val="running",he(n,i,d)}},"Start"),v({onclick:()=>{d.val="running",he(n,i,d)},innerHTML:"&#8635;",class:()=>d.val==="alarm"?"":"hidden"}),v({innerHTML:"&#9881;",onclick:Ye(n)}),v({onclick:()=>{let s=l.findIndex(C=>C.id===n.id);s>=0&&l.splice(s,1)}},"\u274C"))}),N(),w(v({onclick:()=>l.push({id:Ze(l),hours:0,minutes:0,seconds:0,title:"",sound:null})},"Add Timer")),N(),w(ye("Sound"),N(),Se({onchange:n=>O=t.sound=n.target.value},$.map(([n,r])=>X({value:n,selected:n===O},r))))]}function R(e,t,l){return $e({type:"number",value:e||"",placeholder:t,size:3,onchange:l})}function Ue(e,t,l){let n=P({class:()=>l.val==="alarm"?"pointer overlay":"pointer",title:"Click to stop.","aria-label":"Click to stop.",onclick:()=>{l.val="stopped",J(e.id)}},()=>{let r=t.val;if(l.val==="running"){let o=W(Math.floor(r/3600)),a=W(Math.floor(r/60)%60),i=W(r%60);return`${o}:${a}:${i}`}return""});return P({class:"relative-container"},n,P(()=>l.val==="alarm"?P(_e(e.sound??O)):""))}function Ye(e){return()=>{let t=document.createElement("x-dialog");c.add(t,Je({class:"modal"},w(ze({class:"inline"},"Options"),qe({class:"inline",method:"dialog"},v({value:"cancel"},"Close"))),ye("Sound",N(),Se({onchange:l=>{e.sound=l.target.value}},X({value:"default",selected:e.sound==null},"Default"),$.map(([l,n])=>X({value:l,selected:l===e.sound},n)))))),document.body.appendChild(t)}}var ve=$.map(([e])=>e);function _e(e){if(e==="random")return _e(ve[Math.floor(Math.random()*ve.length)]);let t=document.getElementById(e);if(t instanceof HTMLTemplateElement)return t.content.cloneNode(!0)}function Ze(e){return Math.max(...e.map(l=>l.id),0)+1}var ge=document.getElementById("timer");ge?c.add(ge,Qe()):console.error("No timer element found");var g={},k=null;function je(e,t,l){let n=Te(e),r=Date.now()/1e3;g[e.id]={fn:t,startedAt:r,totalSeconds:n,id:e.id,timeoutId:setTimeout(()=>{J(e.id),l(e.id)},n*1e3)},et()}function et(){k||(k=setInterval(()=>{let e=Date.now()/1e3;for(let t of Object.values(g)){let l=e-t.startedAt,n=Math.round(t.totalSeconds-l);t.fn(n)}},1e3))}function J(e){g[e]&&(clearTimeout(g[e].timeoutId),delete g[e],Object.keys(g).length===0&&k&&(clearInterval(k),k=null))}function he(e,t,l){t.val=Te(e),je(e,n=>t.val=n,n=>{l.val="alarm",J(n)})}function Te(e){let{hours:t,minutes:l,seconds:n}=e;return t*3600+l*60+n}function W(e){return e.toString().padStart(2,"0")}})();
